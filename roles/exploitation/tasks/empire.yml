---
- block:

  - name: 'empire : clone repository'
    git:
      accept_hostkey: yes
      clone: yes
      depth: 1
      dest: /opt/empire
      force: yes
      repo: https://github.com/EmpireProject/Empire.git

  - name: 'empire : run installer'
    command: /opt/empire/setup/install.sh
    args:
      chdir: /opt/empire
      creates: /opt/empire/data/empire-chain.pem
    environment:
      STAGING_KEY: RANDOM

  - name: 'empire : add alias'
    lineinfile:
      path: /root/.zshrc
      line: 'alias empire="(cd /opt/empire && ./empire)"'

  tags:
    - exploitation
    - empire
